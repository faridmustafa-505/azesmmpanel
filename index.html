<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giri≈ü | Mobil T…ôsdiql…ôm…ô</title>
    <!-- Tailwind CSS (Dizayn √º√ß√ºn) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome (ƒ∞konlar √º√ß√ºn) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* Y√ºkl…ôm…ô animasiyasƒ± */
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4 font-sans">

    <!-- ∆èsas Kart -->
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden relative">
        
        <!-- Ba≈ülƒ±q Hiss…ôsi -->
        <div class="bg-blue-600 p-6 text-center">
            <h1 class="text-white text-2xl font-bold">Xo≈ü G…ôlmisiniz</h1>
            <p class="text-blue-100 text-sm mt-1">Hesabƒ±nƒ±za daxil olun</p>
        </div>

        <div class="p-8">
            
            <!-- X…ôta Mesajƒ± -->
            <div id="error-message" class="hidden bg-red-50 text-red-600 p-3 rounded-lg text-sm mb-4 border border-red-200 flex items-center">
                <i class="fas fa-exclamation-circle mr-2"></i>
                <span id="error-text">X…ôta ba≈ü verdi.</span>
            </div>

            <!-- Addƒ±m 1: N√∂mr…ô Daxil Etm…ô -->
            <div id="step-phone">
                <label class="block text-gray-700 text-sm font-bold mb-2">Telefon N√∂mr…ôsi</label>
                <div class="flex relative rounded-md shadow-sm">
                    <!-- Sabit +994 Hiss…ôsi -->
                    <span class="inline-flex items-center px-4 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm font-medium">
                        üá¶üáø +994
                    </span>
                    <!-- N√∂mr…ô Inputu -->
                    <input type="tel" id="phone-number" 
                        class="flex-1 min-w-0 block w-full px-4 py-3 rounded-none rounded-r-md border border-gray-300 focus:ring-blue-500 focus:border-blue-500 sm:text-sm outline-none transition" 
                        placeholder="50 123 45 67"
                        maxlength="9"
                        oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                </div>
                <p class="text-xs text-gray-400 mt-2">N√ºmun…ô: 501234567</p>

                <!-- ReCaptcha Container (G√∂r√ºnm…ôz olacaq) -->
                <div id="recaptcha-container" class="mt-4"></div>

                <button id="send-code-btn" onclick="sendOTP()" class="w-full mt-6 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200 flex justify-center items-center shadow-md hover:shadow-lg transform active:scale-95">
                    <span id="send-text">Kodu G√∂nd…ôr</span>
                    <span id="send-loader" class="loader ml-2 hidden"></span>
                </button>
            </div>

            <!-- Addƒ±m 2: OTP T…ôsdiql…ôm…ô -->
            <div id="step-otp" class="hidden">
                <div class="text-center mb-6">
                    <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-blue-100 text-blue-600 mb-3">
                        <i class="fas fa-sms text-xl"></i>
                    </div>
                    <h2 class="text-gray-800 font-bold">Kodu daxil edin</h2>
                    <p class="text-gray-500 text-sm mt-1">
                        <span id="sent-number" class="font-medium">+994...</span> n√∂mr…ôsin…ô SMS g√∂nd…ôrildi.
                    </p>
                </div>

                <input type="text" id="otp-code" 
                    class="block w-full text-center tracking-[0.5em] text-2xl font-bold px-4 py-3 rounded-md border border-gray-300 focus:ring-blue-500 focus:border-blue-500 outline-none transition mb-4" 
                    placeholder="123456"
                    maxlength="6"
                    oninput="this.value = this.value.replace(/[^0-9]/g, '')">

                <button id="verify-btn" onclick="verifyOTP()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200 flex justify-center items-center shadow-md">
                    <span id="verify-text">T…ôsdiql…ô</span>
                    <span id="verify-loader" class="loader ml-2 hidden"></span>
                </button>
                
                <button onclick="resetForm()" class="w-full mt-3 text-gray-500 text-sm hover:text-gray-700 underline">
                    N√∂mr…ôni d…ôyi≈ü
                </button>
            </div>

            <!-- Uƒüurlu Giri≈ü Ekranƒ± (N√ºmun…ô) -->
            <div id="step-success" class="hidden text-center py-6">
                <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-green-100 text-green-600 mb-4 animate-bounce">
                    <i class="fas fa-check text-3xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800">Uƒüurlu Giri≈ü!</h2>
                <p class="text-gray-600 mt-2">Sistem…ô xo≈ü g…ôldiniz.</p>
                <p id="user-uid" class="text-xs text-gray-400 mt-4 break-all"></p>
                <button onclick="firebase.auth().signOut().then(() => location.reload())" class="mt-6 px-6 py-2 border border-red-500 text-red-500 rounded-full hover:bg-red-50 transition">
                    √áƒ±xƒ±≈ü et
                </button>
            </div>

        </div>
        
        <!-- Footer -->
        <div class="bg-gray-50 px-6 py-4 text-center border-t border-gray-100">
            <p class="text-xs text-gray-400">&copy; 2024 B√ºt√ºn h√ºquqlar qorunur.</p>
        </div>
    </div>

    <!-- Firebase SDK Scripts (Compat versiyasƒ± daha sad…ô inteqrasiya √º√ß√ºn) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <script>
        // --- 1. FIREBASE KONFƒ∞QURASƒ∞YASI (BURANI D∆èYƒ∞≈ûƒ∞N!) ---
        // Firebase Console -> Project Settings -> General -> Your apps hiss…ôsind…ôn g√∂t√ºr√ºn.
        const firebaseConfig = {
              apiKey: "AIzaSyALBhMZoDFowkTROYa1awwo-3FbvmnJJpQ",
              authDomain: "azesmmpanel0.firebaseapp.com",
              databaseURL: "https://azesmmpanel0-default-rtdb.firebaseio.com",
              projectId: "azesmmpanel0",
              storageBucket: "azesmmpanel0.firebasestorage.app",
              messagingSenderId: "74060568870",
              appId: "1:74060568870:web:5f5aed2cbef031c2c149e7"
        };

        // Firebase-i i≈ü…ô salƒ±rƒ±q
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        auth.languageCode = 'az'; // SMS dilini Az…ôrbaycan dilin…ô √ßevirir

        // D…ôyi≈ü…ônl…ôr
        let confirmationResult = null;
        const phoneInput = document.getElementById('phone-number');
        const otpInput = document.getElementById('otp-code');
        const errorDiv = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');

        // S…ôhif…ô y√ºkl…ôn…ônd…ô ReCaptcha-nƒ± hazƒ±rlayƒ±rƒ±q
        window.onload = function() {
            renderRecaptcha();
        };

        function renderRecaptcha() {
            if (!window.recaptchaVerifier) {
                window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
                    'size': 'invisible', // 'normal' ets…ôniz g√∂r√ºn…ôn robot testi √ßƒ±xacaq
                    'callback': (response) => {
                        // ReCaptcha h…ôll olundu
                    },
                    'expired-callback': () => {
                        showError("ReCaptcha vaxtƒ± bitdi, yenil…ôyin.");
                    }
                });
                window.recaptchaVerifier.render();
            }
        }

        // --- 2. KODU G√ñND∆èR (Funksiya) ---
        function sendOTP() {
            const phoneNumber = phoneInput.value.trim();
            
            // Sad…ô validasiya
            if (phoneNumber.length < 9) {
                showError("Z…ôhm…ôt olmasa n√∂mr…ôni d√ºzg√ºn daxil edin (m…ôs: 501234567)");
                return;
            }

            setLoading('send', true);
            hideError();

            // +994 prefiksini …ôlav…ô edirik
            const fullPhoneNumber = "+994" + phoneNumber;
            const appVerifier = window.recaptchaVerifier;

            auth.signInWithPhoneNumber(fullPhoneNumber, appVerifier)
                .then((result) => {
                    // SMS g√∂nd…ôrildi
                    confirmationResult = result;
                    setLoading('send', false);
                    
                    // Addƒ±m 2-…ô ke√ßid
                    document.getElementById('step-phone').classList.add('hidden');
                    document.getElementById('step-otp').classList.remove('hidden');
                    document.getElementById('sent-number').innerText = fullPhoneNumber;
                }).catch((error) => {
                    setLoading('send', false);
                    console.error("SMS X…ôtasƒ±:", error);
                    
                    // ReCaptcha-nƒ± sƒ±fƒ±rla ki, yenid…ôn c…ôhd etm…ôk olsun
                    window.recaptchaVerifier.render().then(function(widgetId) {
                        grecaptcha.reset(widgetId);
                    });

                    if (error.code === 'auth/invalid-phone-number') {
                        showError("N√∂mr…ô formatƒ± yanlƒ±≈üdƒ±r.");
                    } else if (error.code === 'auth/too-many-requests') {
                        showError("√áox sayda c…ôhd edildi. Bir az sonra yoxlayƒ±n.");
                    } else {
                        showError("SMS g√∂nd…ôril…ô bilm…ôdi: " + error.message);
                    }
                });
        }

        // --- 3. KODU T∆èSDƒ∞QL∆è (Funksiya) ---
        function verifyOTP() {
            const code = otpInput.value.trim();
            
            if (code.length !== 6) {
                showError("Kod 6 r…ôq…ômli olmalƒ±dƒ±r.");
                return;
            }

            setLoading('verify', true);
            hideError();

            confirmationResult.confirm(code).then((result) => {
                // Uƒüurlu giri≈ü
                const user = result.user;
                setLoading('verify', false);
                
                // Uƒüur ekranƒ±na ke√ßid
                document.getElementById('step-otp').classList.add('hidden');
                document.getElementById('step-success').classList.remove('hidden');
                document.getElementById('user-uid').innerText = "User ID: " + user.uid;
                
            }).catch((error) => {
                setLoading('verify', false);
                console.error("T…ôsdiq X…ôtasƒ±:", error);
                showError("Kod yanlƒ±≈üdƒ±r v…ô ya m√ºdd…ôti bitib.");
            });
        }

        // K√∂m…ôk√ßi funksiyalar
        function showError(msg) {
            errorDiv.classList.remove('hidden');
            errorText.innerText = msg;
        }

        function hideError() {
            errorDiv.classList.add('hidden');
        }

        function setLoading(type, isLoading) {
            const btn = document.getElementById(type + '-btn');
            const text = document.getElementById(type + '-text');
            const loader = document.getElementById(type + '-loader');

            if (isLoading) {
                btn.disabled = true;
                btn.classList.add('opacity-70', 'cursor-not-allowed');
                text.innerText = "G√∂zl…ôyin...";
                loader.classList.remove('hidden');
            } else {
                btn.disabled = false;
                btn.classList.remove('opacity-70', 'cursor-not-allowed');
                text.innerText = type === 'send' ? "Kodu G√∂nd…ôr" : "T…ôsdiql…ô";
                loader.classList.add('hidden');
            }
        }

        function resetForm() {
            document.getElementById('step-otp').classList.add('hidden');
            document.getElementById('step-phone').classList.remove('hidden');
            otpInput.value = '';
            hideError();
            
            // ReCaptcha-nƒ± yenil…ô
             window.recaptchaVerifier.render().then(function(widgetId) {
                grecaptcha.reset(widgetId);
            });
        }
    </script>
</body>
</html>
